<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Administrador</title>
    <link rel="stylesheet" href="../Vista/AdminProducto.css" />
  </head>
  <body>
    <!--Cuerpo de la pagina-->
    <div class="cuerpo">
      <div class="user">
        <div class="datosPersonales">
          <div class="imagenUser">
            <img
              src="../img/person-svgrepo-com.svg"
              id="imgUsuario"
              alt="imgdelUsuario"
            />
          </div>
          <div class="infoUser">
            <p id="nombre">Administrador</p>
            <p id="correo">Ejemplo@hotmail.com</p>
          </div>
        </div>
        <div class="opciones">
          <div class="opcuerpo">
            <button
              class="opcButton"
              onclick="abrirPagina('AccesoPage.html')"
              type="button"
            >
              Administracion
              <svg
                width="24px"
                height="24px"
                viewBox="-4.5 0 20 20"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
              >
                <title>arrow_right [#336]</title>
                <desc>Created with Sketch.</desc>
                <defs></defs>
                <g
                  id="Page-1"
                  stroke="none"
                  stroke-width="1"
                  fill="none"
                  fill-rule="evenodd"
                >
                  <g
                    id="Dribbble-Light-Preview"
                    transform="translate(-305.000000, -6679.000000)"
                    fill="#000000"
                  >
                    <g id="icons" transform="translate(56.000000, 160.000000)">
                      <path
                        d="M249.365851,6538.70769 L249.365851,6538.70769 C249.770764,6539.09744 250.426289,6539.09744 250.830166,6538.70769 L259.393407,6530.44413 C260.202198,6529.66364 260.202198,6528.39747 259.393407,6527.61699 L250.768031,6519.29246 C250.367261,6518.90671 249.720021,6518.90172 249.314072,6519.28247 L249.314072,6519.28247 C248.899839,6519.67121 248.894661,6520.31179 249.302681,6520.70653 L257.196934,6528.32352 C257.601847,6528.71426 257.601847,6529.34685 257.196934,6529.73759 L249.365851,6537.29462 C248.960938,6537.68437 248.960938,6538.31795 249.365851,6538.70769"
                        id="arrow_right-[#336]"
                      ></path>
                    </g>
                  </g>
                </g>
              </svg>
            </button>
            <button
              class="opcButton"
              onclick="abrirPagina('AdminProducto.html')"
              type="button"
            >
              Productos
              <svg
                width="24px"
                height="24px"
                viewBox="-4.5 0 20 20"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
              >
                <title>arrow_right [#336]</title>
                <desc>Created with Sketch.</desc>
                <defs></defs>
                <g
                  id="Page-1"
                  stroke="none"
                  stroke-width="1"
                  fill="none"
                  fill-rule="evenodd"
                >
                  <g
                    id="Dribbble-Light-Preview"
                    transform="translate(-305.000000, -6679.000000)"
                    fill="#000000"
                  >
                    <g id="icons" transform="translate(56.000000, 160.000000)">
                      <path
                        d="M249.365851,6538.70769 L249.365851,6538.70769 C249.770764,6539.09744 250.426289,6539.09744 250.830166,6538.70769 L259.393407,6530.44413 C260.202198,6529.66364 260.202198,6528.39747 259.393407,6527.61699 L250.768031,6519.29246 C250.367261,6518.90671 249.720021,6518.90172 249.314072,6519.28247 L249.314072,6519.28247 C248.899839,6519.67121 248.894661,6520.31179 249.302681,6520.70653 L257.196934,6528.32352 C257.601847,6528.71426 257.601847,6529.34685 257.196934,6529.73759 L249.365851,6537.29462 C248.960938,6537.68437 248.960938,6538.31795 249.365851,6538.70769"
                        id="arrow_right-[#336]"
                      ></path>
                    </g>
                  </g>
                </g>
              </svg>
            </button>
            <button class="opcButton">
              Compras
              <svg
                width="24px"
                height="24px"
                viewBox="-4.5 0 20 20"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
              >
                <title>arrow_right [#336]</title>
                <desc>Created with Sketch.</desc>
                <defs></defs>
                <g
                  id="Page-1"
                  stroke="none"
                  stroke-width="1"
                  fill="none"
                  fill-rule="evenodd"
                >
                  <g
                    id="Dribbble-Light-Preview"
                    transform="translate(-305.000000, -6679.000000)"
                    fill="#000000"
                  >
                    <g id="icons" transform="translate(56.000000, 160.000000)">
                      <path
                        d="M249.365851,6538.70769 L249.365851,6538.70769 C249.770764,6539.09744 250.426289,6539.09744 250.830166,6538.70769 L259.393407,6530.44413 C260.202198,6529.66364 260.202198,6528.39747 259.393407,6527.61699 L250.768031,6519.29246 C250.367261,6518.90671 249.720021,6518.90172 249.314072,6519.28247 L249.314072,6519.28247 C248.899839,6519.67121 248.894661,6520.31179 249.302681,6520.70653 L257.196934,6528.32352 C257.601847,6528.71426 257.601847,6529.34685 257.196934,6529.73759 L249.365851,6537.29462 C248.960938,6537.68437 248.960938,6538.31795 249.365851,6538.70769"
                        id="arrow_right-[#336]"
                      ></path>
                    </g>
                  </g>
                </g>
              </svg>
            </button>
            <button class="opcButton">
              Ventas
              <svg
                width="24px"
                height="24px"
                viewBox="-4.5 0 20 20"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
              >
                <title>arrow_right [#336]</title>
                <desc>Created with Sketch.</desc>
                <defs></defs>
                <g
                  id="Page-1"
                  stroke="none"
                  stroke-width="1"
                  fill="none"
                  fill-rule="evenodd"
                >
                  <g
                    id="Dribbble-Light-Preview"
                    transform="translate(-305.000000, -6679.000000)"
                    fill="#000000"
                  >
                    <g id="icons" transform="translate(56.000000, 160.000000)">
                      <path
                        d="M249.365851,6538.70769 L249.365851,6538.70769 C249.770764,6539.09744 250.426289,6539.09744 250.830166,6538.70769 L259.393407,6530.44413 C260.202198,6529.66364 260.202198,6528.39747 259.393407,6527.61699 L250.768031,6519.29246 C250.367261,6518.90671 249.720021,6518.90172 249.314072,6519.28247 L249.314072,6519.28247 C248.899839,6519.67121 248.894661,6520.31179 249.302681,6520.70653 L257.196934,6528.32352 C257.601847,6528.71426 257.601847,6529.34685 257.196934,6529.73759 L249.365851,6537.29462 C248.960938,6537.68437 248.960938,6538.31795 249.365851,6538.70769"
                        id="arrow_right-[#336]"
                      ></path>
                    </g>
                  </g>
                </g>
              </svg>
            </button>
            <button class="opcButton">
              Proveedores
              <svg
                width="24px"
                height="24px"
                viewBox="-4.5 0 20 20"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
              >
                <title>arrow_right [#336]</title>
                <desc>Created with Sketch.</desc>
                <defs></defs>
                <g
                  id="Page-1"
                  stroke="none"
                  stroke-width="1"
                  fill="none"
                  fill-rule="evenodd"
                >
                  <g
                    id="Dribbble-Light-Preview"
                    transform="translate(-305.000000, -6679.000000)"
                    fill="#000000"
                  >
                    <g id="icons" transform="translate(56.000000, 160.000000)">
                      <path
                        d="M249.365851,6538.70769 L249.365851,6538.70769 C249.770764,6539.09744 250.426289,6539.09744 250.830166,6538.70769 L259.393407,6530.44413 C260.202198,6529.66364 260.202198,6528.39747 259.393407,6527.61699 L250.768031,6519.29246 C250.367261,6518.90671 249.720021,6518.90172 249.314072,6519.28247 L249.314072,6519.28247 C248.899839,6519.67121 248.894661,6520.31179 249.302681,6520.70653 L257.196934,6528.32352 C257.601847,6528.71426 257.601847,6529.34685 257.196934,6529.73759 L249.365851,6537.29462 C248.960938,6537.68437 248.960938,6538.31795 249.365851,6538.70769"
                        id="arrow_right-[#336]"
                      ></path>
                    </g>
                  </g>
                </g>
              </svg>
            </button>
            <button class="opcButton">
              Reportes
              <svg
                width="24px"
                height="24px"
                viewBox="-4.5 0 20 20"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
              >
                <title>arrow_right [#336]</title>
                <desc>Created with Sketch.</desc>
                <defs></defs>
                <g
                  id="Page-1"
                  stroke="none"
                  stroke-width="1"
                  fill="none"
                  fill-rule="evenodd"
                >
                  <g
                    id="Dribbble-Light-Preview"
                    transform="translate(-305.000000, -6679.000000)"
                    fill="#000000"
                  >
                    <g id="icons" transform="translate(56.000000, 160.000000)">
                      <path
                        d="M249.365851,6538.70769 L249.365851,6538.70769 C249.770764,6539.09744 250.426289,6539.09744 250.830166,6538.70769 L259.393407,6530.44413 C260.202198,6529.66364 260.202198,6528.39747 259.393407,6527.61699 L250.768031,6519.29246 C250.367261,6518.90671 249.720021,6518.90172 249.314072,6519.28247 L249.314072,6519.28247 C248.899839,6519.67121 248.894661,6520.31179 249.302681,6520.70653 L257.196934,6528.32352 C257.601847,6528.71426 257.601847,6529.34685 257.196934,6529.73759 L249.365851,6537.29462 C248.960938,6537.68437 248.960938,6538.31795 249.365851,6538.70769"
                        id="arrow_right-[#336]"
                      ></path>
                    </g>
                  </g>
                </g>
              </svg>
              <button class="opcButton">
                Devoluciones
                <svg
                  width="24px"
                  height="24px"
                  viewBox="-4.5 0 20 20"
                  version="1.1"
                  xmlns="http://www.w3.org/2000/svg"
                  xmlns:xlink="http://www.w3.org/1999/xlink"
                >
                  <title>arrow_right [#336]</title>
                  <desc>Created with Sketch.</desc>
                  <defs></defs>
                  <g
                    id="Page-1"
                    stroke="none"
                    stroke-width="1"
                    fill="none"
                    fill-rule="evenodd"
                  >
                    <g
                      id="Dribbble-Light-Preview"
                      transform="translate(-305.000000, -6679.000000)"
                      fill="#000000"
                    >
                      <g
                        id="icons"
                        transform="translate(56.000000, 160.000000)"
                      >
                        <path
                          d="M249.365851,6538.70769 L249.365851,6538.70769 C249.770764,6539.09744 250.426289,6539.09744 250.830166,6538.70769 L259.393407,6530.44413 C260.202198,6529.66364 260.202198,6528.39747 259.393407,6527.61699 L250.768031,6519.29246 C250.367261,6518.90671 249.720021,6518.90172 249.314072,6519.28247 L249.314072,6519.28247 C248.899839,6519.67121 248.894661,6520.31179 249.302681,6520.70653 L257.196934,6528.32352 C257.601847,6528.71426 257.601847,6529.34685 257.196934,6529.73759 L249.365851,6537.29462 C248.960938,6537.68437 248.960938,6538.31795 249.365851,6538.70769"
                          id="arrow_right-[#336]"
                        ></path>
                      </g>
                    </g>
                  </g>
                </svg>
              </button>
            </button>
          </div>
        </div>
      </div>
      <div class="contenido">
        <div class="infoCont">
          <div class="titulo">
            <h2>PRODUCTO:</h2>
          </div>
          <div class="subTitulo">
            <p>Todos los productos:</p>
            <div class="barra-busqueda">
              <img
                src="../img/busqueda.png"
                alt="Buscar"
                width="20"
                height="20"
              />
              <input type="text" placeholder="Buscar..." />
            </div>
            <a href="Reguister_prouctos.html" class="aÃ±adirButton">
              <div class="aÃ±adir">AÃ±adir +</div>
            </a>
          </div>
        </div>
        <div class="cont">
          <!-- Contenedor dinÃ¡mico para los productos -->
          <div id="productos-container">
            <!-- Los productos se cargarÃ¡n aquÃ­ dinÃ¡micamente -->
            <p>Cargando productos...</p>
          </div>
        </div>
      </div>
    </div>
    <!-- Aqui el modal editar producto-->

    <div id="modalEditarProducto" class="modal-overlay" style="display: none">
      <div class="form-container">
        <button
          class="close-modal-btn"
          id="cerrarModalEditar"
          aria-label="Cerrar"
        >
          Ã—
        </button>
        <h1>Actualiza el Producto</h1>
        <p>
          Completa los siguientes campos actualizar el artÃ­culo del catÃ¡logo.
        </p>
        <form id="formRegistrarProducto" class="product-form">
          <div class="form-group">
            <label for="productName">Nombre del Producto</label>
            <input
              type="text"
              id="productName"
              name="nombre"
              placeholder="Ej: Mouse Gamer InalÃ¡mbrico"
              required
            />
          </div>
          <div class="form-group">
            <label for="productBrand">Marca</label>
            <input
              type="text"
              id="productBrand"
              name="marca"
              placeholder="Ej: Logitech"
              required
            />
          </div>
          <div class="form-group">
            <label for="productDescription">DescripciÃ³n</label>
            <textarea
              id="productDescription"
              name="descripcion"
              rows="5"
              placeholder="Describe las caracterÃ­sticas principales del producto."
              required
            ></textarea>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="productPrice">Precio (S/)</label>
              <input
                type="number"
                id="productPrice"
                name="precio"
                step="0.01"
                placeholder="Ej: 199.90"
                required
              />
            </div>
            <div class="form-group">
              <label for="productStock">Stock</label>
              <input
                type="number"
                id="productStock"
                name="stock"
                placeholder="Ej: 50"
                required
              />
            </div>
          </div>
          <button type="submit" class="submit-btn">Actualizar Producto</button>
        </form>
      </div>
    </div>

    <!-- Modal para confirmar eliminaciÃ³n -->
    <div id="modalEliminarProducto" class="modal-overlay" style="display: none">
      <div class="confirm-container">
        <button
          class="close-modal-btn"
          id="cerrarModalEliminar"
          aria-label="Cerrar"
        >
          Ã—
        </button>
        <div class="confirm-content">
          <div class="confirm-icon">
            <!-- Puedes usar un Ã­cono SVG de advertencia aquÃ­ si deseas -->
            <svg width="38" height="38" viewBox="0 0 24 24" fill="none">
              <circle cx="12" cy="12" r="12" fill="#ff4d4f" />
              <path
                d="M12 7v5M12 16h.01"
                stroke="#fff"
                stroke-width="2"
                stroke-linecap="round"
              />
            </svg>
          </div>
          <div>
            <h2 class="confirm-title">Â¿Eliminar producto?</h2>
            <p class="confirm-text">
              Esta acciÃ³n no se puede deshacer. Â¿Seguro que deseas eliminar este
              producto?
            </p>
            <div class="confirm-actions">
              <button class="submit-btn eliminar-btn" id="confirmarEliminar">
                Eliminar
              </button>
              <button class="submit-btn cancelar-btn" id="cancelarEliminar">
                Cancelar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>

  <!-- Scripts para cargar productos dinÃ¡micamente -->
  <script src="../Controlador/getProductoControlles.js"></script>
  <script src="../Controlador/modificarProducto.js"></script>
  <script>
    function abrirPagina(url) {
      window.location.href = url;
    }

    // FunciÃ³n personalizada para renderizar productos en el estilo del admin
    async function renderizarProductosAdmin() {
      const container = document.getElementById('productos-container');
      if (!container) {
        console.error('Contenedor productos-container no encontrado');
        return;
      }

      try {
        // Mostrar loading
        container.innerHTML = '<p>Cargando productos...</p>';
        
        // Obtener productos con imÃ¡genes
        const productosConImagenes = await obtenerProductosConImagenes();
        
        // Limpiar container
        container.innerHTML = '';
        
        // Renderizar cada producto en el estilo del admin
        productosConImagenes.forEach(({ producto, imagenes }) => {
          // Obtener la imagen principal o la primera imagen
          const imagenPrincipal = imagenes.find(img => img.es_principal) || imagenes[0];
          const srcImagen = imagenPrincipal ? imagenPrincipal.url_completa : '../img/placeholder.jpg';
          
          const productoDiv = document.createElement('div');
          productoDiv.className = 'productos';
          // Agregar todos los datos del producto como atributos data-*
          productoDiv.setAttribute('data-producto-id', producto.id);
          productoDiv.setAttribute('data-producto-nombre', producto.nombre || '');
          productoDiv.setAttribute('data-producto-marca', producto.marca || '');
          productoDiv.setAttribute('data-producto-descripcion', producto.descripcion || '');
          productoDiv.setAttribute('data-producto-precio', producto.precio || '');
          productoDiv.setAttribute('data-producto-stock', producto.stock || '');
          productoDiv.setAttribute('data-producto-disponible', producto.disponible || false);
          productoDiv.setAttribute('data-producto-imagen', srcImagen);
          
          productoDiv.innerHTML = `
            <div class="content-img">
              <img class="img-product" src="${srcImagen}" alt="${producto.nombre}">
            </div>
            <div class="infoProduct">
              <div class="infoProductMax">
                <div class="nombre">
                  <p>${producto.nombre}</p>
                </div>
                <div class="precio">
                  <p>S/${producto.precio}</p>
                </div>
                <!-- InformaciÃ³n adicional oculta para acceso desde DOM -->
                <div class="datos-ocultos" style="display: none;">
                  <span class="marca">${producto.marca || ''}</span>
                  <span class="descripcion">${producto.descripcion || ''}</span>
                  <span class="stock">${producto.stock || ''}</span>
                  <span class="disponible">${producto.disponible || false}</span>
                </div>
              </div>
              <div class="nav-item">
                <span class="tresPuntos" data-producto-id="${producto.id}">...</span>
                <div class="dropdown-menu">
                  <a href="#" class="dropdown-item" onclick="editarProducto(${producto.id})">Modificar</a>
                  <a href="#" class="dropdown-item" onclick="eliminarProducto(${producto.id})">Eliminar</a>
                </div>
              </div>
            </div>
          `;
          
          container.appendChild(productoDiv);
        });
        
        if (productosConImagenes.length === 0) {
          container.innerHTML = '<p>No se encontraron productos</p>';
        }
        
        // Reactivar los event listeners para los dropdowns
        activarDropdowns();
        
      } catch (error) {
        console.error('Error al renderizar productos:', error);
        container.innerHTML = '<p>Error al cargar productos</p>';
      }
    }

    // FunciÃ³n para activar los dropdowns
    function activarDropdowns() {
      document.querySelectorAll('.tresPuntos').forEach(function(span) {
        span.addEventListener('click', function(e) {
          e.stopPropagation();
          const dropdown = this.nextElementSibling;
          // Cerrar otros dropdowns
          document.querySelectorAll('.dropdown-menu').forEach(function(menu) {
            if (menu !== dropdown) {
              menu.style.display = 'none';
            }
          });
          // Toggle del dropdown actual
          dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        });
      });

      // Cerrar dropdowns al hacer click fuera
      document.addEventListener('click', function() {
        document.querySelectorAll('.dropdown-menu').forEach(function(menu) {
          menu.style.display = 'none';
        });
      });
    }

    // Variable global para almacenar el ID del producto a eliminar
    let productoIdAEliminar = null;

    // Funciones para editar y eliminar productos
    function editarProducto(id) {
      console.log('ðŸ”§ Iniciando ediciÃ³n de producto ID:', id);
      
      // 1. Intentar extraer datos del DOM primero
      const datosDOM = extraerDatosProductoDelDOM(id);
      
      // 2. Abrir modal
      const modal = document.getElementById('modalEditarProducto');
      if (!modal) {
        console.error('âŒ Modal no encontrado');
        return;
      }
      
      modal.style.display = 'flex';
      
      // 3. Si hay datos del DOM, llenar el formulario inmediatamente
      if (datosDOM) {
        console.log('âœ… Llenando formulario con datos del DOM:', datosDOM);
        llenarFormularioConDatos(datosDOM, id);
      }
      
      // 4. Si estÃ¡ disponible la funciÃ³n de modificarProducto.js, usarla para obtener datos adicionales
      if (typeof window.editarProductoModal === 'function') {
        console.log('âœ… TambiÃ©n ejecutando funciÃ³n de modificarProducto.js para datos completos');
        // No llamamos window.editarProductoModal(id) porque ya abrimos el modal
        // En su lugar, solo obtenemos los datos de Supabase si es necesario
        if (typeof window.cargarDatosProductoDesdeSupabase === 'function') {
          window.cargarDatosProductoDesdeSupabase(id);
        }
      } else {
        console.warn('âš ï¸ FunciÃ³n editarProductoModal no disponible, usando solo datos del DOM');
        // Configurar el formulario para ediciÃ³n
        const form = document.getElementById('formRegistrarProducto');
        if (form) {
          form.setAttribute('data-producto-id', id);
        }
      }
    }

    // FunciÃ³n para extraer datos del producto desde el DOM
    function extraerDatosProductoDelDOM(id) {
      try {
        // MÃ©todo 1: Buscar por atributo data-producto-id en el contenedor principal
        let contenedorProducto = document.querySelector(`[data-producto-id="${id}"].productos`);
        
        // MÃ©todo 2: Si no se encuentra, buscar el span con data-producto-id y navegar al contenedor
        if (!contenedorProducto) {
          const elementoProducto = document.querySelector(`span[data-producto-id="${id}"]`);
          if (elementoProducto) {
            contenedorProducto = elementoProducto.closest('.productos');
          }
        }

        if (!contenedorProducto) {
          console.warn('âš ï¸ No se encontrÃ³ contenedor del producto para el ID:', id);
          return null;
        }

        // Extraer datos desde atributos data-* (mÃ©todo preferido)
        const datosAtributos = {
          id: id,
          nombre: contenedorProducto.getAttribute('data-producto-nombre') || '',
          marca: contenedorProducto.getAttribute('data-producto-marca') || '',
          descripcion: contenedorProducto.getAttribute('data-producto-descripcion') || '',
          precio: contenedorProducto.getAttribute('data-producto-precio') || '',
          stock: contenedorProducto.getAttribute('data-producto-stock') || '',
          disponible: contenedorProducto.getAttribute('data-producto-disponible') === 'true',
          imagen: contenedorProducto.getAttribute('data-producto-imagen') || ''
        };

        // Si los atributos tienen datos, usarlos
        if (datosAtributos.nombre) {
          console.log('âœ… Datos extraÃ­dos del DOM (atributos data-*):', datosAtributos);
          return datosAtributos;
        }

        // MÃ©todo fallback: extraer desde elementos DOM visibles
        const nombre = contenedorProducto.querySelector('.nombre p')?.textContent?.trim();
        const precioTexto = contenedorProducto.querySelector('.precio p')?.textContent?.trim();
        const precio = precioTexto ? precioTexto.replace('S/', '').trim() : '';
        const imagenSrc = contenedorProducto.querySelector('.img-product')?.src;

        // Intentar extraer datos ocultos
        const datosOcultos = contenedorProducto.querySelector('.datos-ocultos');
        let marca = '', descripcion = '', stock = '', disponible = false;
        
        if (datosOcultos) {
          marca = datosOcultos.querySelector('.marca')?.textContent?.trim() || '';
          descripcion = datosOcultos.querySelector('.descripcion')?.textContent?.trim() || '';
          stock = datosOcultos.querySelector('.stock')?.textContent?.trim() || '';
          disponible = datosOcultos.querySelector('.disponible')?.textContent?.trim() === 'true';
        }

        const datosFallback = {
          id: id,
          nombre: nombre || '',
          marca: marca,
          descripcion: descripcion,
          precio: precio || '',
          stock: stock,
          disponible: disponible,
          imagen: imagenSrc || ''
        };

        console.log('âœ… Datos extraÃ­dos del DOM (fallback):', datosFallback);
        return datosFallback;

      } catch (error) {
        console.error('âŒ Error al extraer datos del DOM:', error);
        return null;
      }
    }

    // FunciÃ³n para llenar el formulario con los datos extraÃ­dos
    function llenarFormularioConDatos(datos, id) {
      try {
        const form = document.getElementById('formRegistrarProducto');
        if (!form) {
          console.error('âŒ Formulario no encontrado');
          return;
        }

        // Configurar el formulario para ediciÃ³n
        form.setAttribute('data-producto-id', id);

        // Mapeo de campos del formulario
        const campos = {
          'nombreProducto': datos.nombre,
          'marcaProducto': datos.marca,
          'descripcionProducto': datos.descripcion,
          'precioProducto': datos.precio,
          'stockProducto': datos.stock,
          'disponibleProducto': datos.disponible
        };

        // Llenar campos de texto y select
        Object.keys(campos).forEach(fieldId => {
          const field = document.getElementById(fieldId);
          if (field && campos[fieldId] !== undefined && campos[fieldId] !== '') {
            if (field.type === 'checkbox') {
              field.checked = Boolean(campos[fieldId]);
            } else {
              field.value = campos[fieldId];
            }
            
            // Agregar efecto visual de carga exitosa
            field.style.borderColor = '#28a745';
            field.style.backgroundColor = '#f8fff9';
            setTimeout(() => {
              field.style.borderColor = '';
              field.style.backgroundColor = '';
            }, 2000);
            
            console.log(`âœ… Campo ${fieldId} llenado con: ${campos[fieldId]}`);
          }
        });

        // Si hay imagen disponible, mostrarla como preview
        if (datos.imagen) {
          mostrarPreviewImagen(datos.imagen);
        }

        // Mostrar indicador de Ã©xito
        mostrarNotificacionEnFormulario('Datos bÃ¡sicos cargados desde la pÃ¡gina', 'success');

        console.log('âœ… Formulario llenado con datos del DOM');

      } catch (error) {
        console.error('âŒ Error al llenar formulario:', error);
      }
    }

    // FunciÃ³n auxiliar para mostrar notificaciÃ³n en el formulario
    function mostrarNotificacionEnFormulario(mensaje, tipo = 'info') {
      try {
        // Remover notificaciÃ³n anterior si existe
        const notificacionAnterior = document.getElementById('notificacion-formulario');
        if (notificacionAnterior) {
          notificacionAnterior.remove();
        }

        // Crear nueva notificaciÃ³n
        const notificacion = document.createElement('div');
        notificacion.id = 'notificacion-formulario';
        notificacion.textContent = mensaje;
        
        const colores = {
          'success': { bg: '#d4edda', color: '#155724', border: '#c3e6cb' },
          'warning': { bg: '#fff3cd', color: '#856404', border: '#ffeaa7' },
          'error': { bg: '#f8d7da', color: '#721c24', border: '#f5c6cb' },
          'info': { bg: '#d1ecf1', color: '#0c5460', border: '#bee5eb' }
        };

        const estilo = colores[tipo] || colores.info;
        
        notificacion.style.cssText = `
          background-color: ${estilo.bg};
          color: ${estilo.color};
          border: 1px solid ${estilo.border};
          padding: 10px;
          border-radius: 5px;
          margin: 10px 0;
          font-size: 14px;
          animation: fadeIn 0.3s ease-in;
        `;

        // Insertar al inicio del formulario
        const form = document.getElementById('formRegistrarProducto');
        if (form) {
          form.insertBefore(notificacion, form.firstChild);
          
          // Auto-remover despuÃ©s de 5 segundos
          setTimeout(() => {
            if (notificacion && notificacion.parentNode) {
              notificacion.style.animation = 'fadeOut 0.3s ease-out';
              setTimeout(() => notificacion.remove(), 300);
            }
          }, 5000);
        }

      } catch (error) {
        console.error('âŒ Error al mostrar notificaciÃ³n:', error);
      }
    }

    // FunciÃ³n auxiliar para mostrar preview de imagen
    function mostrarPreviewImagen(imagenSrc) {
      try {
        // Buscar o crear elemento de preview
        let preview = document.getElementById('imagen-preview');
        if (!preview) {
          preview = document.createElement('img');
          preview.id = 'imagen-preview';
          preview.style.cssText = `
            max-width: 200px;
            max-height: 200px;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin: 10px 0;
            display: block;
          `;
          
          // Insertar despuÃ©s del campo de imagen
          const campoImagen = document.getElementById('imagenProducto');
          if (campoImagen && campoImagen.parentNode) {
            campoImagen.parentNode.insertBefore(preview, campoImagen.nextSibling);
          }
        }
        
        preview.src = imagenSrc;
        preview.alt = 'Vista previa del producto';
        console.log('âœ… Preview de imagen mostrado');
        
      } catch (error) {
        console.error('âŒ Error al mostrar preview de imagen:', error);
      }
    }

    function eliminarProducto(id) {
      console.log('Solicitar eliminar producto ID:', id);
      productoIdAEliminar = id;
      document.getElementById('modalEliminarProducto').style.display = 'flex';
    }

    // Cargar productos al cargar la pÃ¡gina
    document.addEventListener('DOMContentLoaded', function() {
      renderizarProductosAdmin();
    });

    // Modal editar producto - Cerrar
    document.getElementById('cerrarModalEditar').addEventListener('click', function() {
      document.getElementById('modalEditarProducto').style.display = 'none';
    });

    document.getElementById('modalEditarProducto').addEventListener('click', function(e) {
      if(e.target === this) {
        this.style.display = 'none';
      }
    });

    // Modal eliminar producto - Cerrar
    document.getElementById('cerrarModalEliminar').addEventListener('click', function() {
      document.getElementById('modalEliminarProducto').style.display = 'none';
      productoIdAEliminar = null;
    });

    document.getElementById('cancelarEliminar').addEventListener('click', function() {
      document.getElementById('modalEliminarProducto').style.display = 'none';
      productoIdAEliminar = null;
    });

    document.getElementById('modalEliminarProducto').addEventListener('click', function(e) {
      if(e.target === this) {
        this.style.display = 'none';
        productoIdAEliminar = null;
      }
    });

    // Confirmar eliminaciÃ³n
    document.getElementById('confirmarEliminar').addEventListener('click', function() {
      if (productoIdAEliminar) {
        console.log('Eliminando producto ID:', productoIdAEliminar);
        // TODO: AquÃ­ implementar la lÃ³gica para eliminar de la BD
        alert(`Producto ${productoIdAEliminar} eliminado (simulado)`);
        document.getElementById('modalEliminarProducto').style.display = 'none';
        productoIdAEliminar = null;
        // Recargar productos
        renderizarProductosAdmin();
      }
    });

    // =======================================================
    // FUNCIONES DE DEBUG Y TESTING
    // =======================================================

    // FunciÃ³n para probar la extracciÃ³n de datos del DOM
    window.debugExtraerDatos = function(id) {
      console.log('ðŸ§ª DEBUG: Probando extracciÃ³n de datos para ID:', id);
      const datos = extraerDatosProductoDelDOM(id);
      console.log('ðŸ§ª DEBUG: Datos extraÃ­dos:', datos);
      return datos;
    };

    // FunciÃ³n para probar el llenado del formulario
    window.debugLlenarFormulario = function(id) {
      console.log('ðŸ§ª DEBUG: Probando llenado de formulario para ID:', id);
      const datos = extraerDatosProductoDelDOM(id);
      if (datos) {
        llenarFormularioConDatos(datos, id);
        console.log('ðŸ§ª DEBUG: Formulario llenado exitosamente');
      } else {
        console.error('ðŸ§ª DEBUG: No se pudieron extraer datos');
      }
    };

    // FunciÃ³n para listar todos los productos disponibles en el DOM
    window.debugListarProductos = function() {
      console.log('ðŸ§ª DEBUG: Listando productos en el DOM...');
      const productos = document.querySelectorAll('.productos[data-producto-id]');
      productos.forEach((producto, index) => {
        const id = producto.getAttribute('data-producto-id');
        const nombre = producto.getAttribute('data-producto-nombre');
        console.log(`ðŸ§ª DEBUG: Producto ${index + 1}: ID=${id}, Nombre=${nombre}`);
      });
      console.log(`ðŸ§ª DEBUG: Total de productos encontrados: ${productos.length}`);
      return productos;
    };

    // Log de inicializaciÃ³n
    console.log('âœ… Sistema de ediciÃ³n de productos inicializado');
    console.log('ðŸ”§ Funciones de debug disponibles:');
    console.log('   - window.debugExtraerDatos(id)');
    console.log('   - window.debugLlenarFormulario(id)');
    console.log('   - window.debugListarProductos()');
  </script>

  <style>
    /* Animaciones para notificaciones */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeOut {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(-10px); }
    }

    /* Estilos para preview de imagen */
    #imagen-preview {
      transition: all 0.3s ease;
    }

    #imagen-preview:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    /* Estilos para campos con datos cargados */
    .campo-cargado {
      animation: resaltarCampo 2s ease-in-out;
    }

    @keyframes resaltarCampo {
      0% { background-color: #f8fff9; border-color: #28a745; }
      100% { background-color: transparent; border-color: initial; }
    }

    /* ...existing CSS... */
  </style>
</html>
